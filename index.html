<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Where Are We Eating?</title>
<style>
body { font-family: Arial; text-align: center; background: #f4f4f4; padding: 20px; }
select, button, label { margin: 5px; padding: 6px; }
canvas { background: white; border-radius: 50%; margin-top: 20px; }
#result { margin-top: 20px; font-size: 22px; font-weight: bold; }
.arrow { font-size: 40px; margin-top: 10px; }
small { display:block; margin-top:5px; color:#555;}
button { cursor:pointer; }
</style>
</head>
<body>

<h1>ğŸ½ï¸ Yo Where We Eating???</h1>

<div>
  <select id="cuisine"><option value="">All Cuisines</option></select>
  <select id="price">
    <option value="">All Prices</option>
    <option value="$">$</option>
    <option value="$$">$$</option>
    <option value="$$$">$$$</option>
  </select>
  <select id="area"><option value="">All Areas</option></select>
  <label><input type="checkbox" id="outdoor"> Outdoor</label>
  <br>
  <button onclick="applyFilters()">Apply Filters</button>
  <button onclick="spinWheel()">Spin ğŸ¯</button>
  <small>â­ Higher rated restaurants have higher chance</small>
  <medium>â›ª Church service is over, it's time to eat!</medium>
  <medium>ğŸ˜µ HURRY UP, Wayne is hungry!! </medium>
</div>

<div class="arrow">â¬‡ï¸</div>
<canvas id="wheel" width="400" height="400"></canvas>
<div id="result"></div>

<script>

// ğŸ”¥ PASTE YOUR GOOGLE SHEET CSV URL HERE
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTIn64jOImdiKHLZfnJKGilvkY_aCLAJzeAKpdmOXogQqjbvLWr6NUZTyS5iAYojIoJb2IKChi0JXEP/pub?output=csv";

let restaurants = [];
let filteredRestaurants = [];
let currentRotation = 0;

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

// ================= FETCH DATA =================
async function fetchSheet() {
  const response = await fetch(SHEET_URL);
  const data = await response.text();
  const rows = data.split("\n").slice(1);

  restaurants = rows
    .filter(r => r.trim() !== "")
    .map(row => {
      const [name, cuisine, price, area, outdoor, rating] = row.split(",");
      return {
        name: name?.trim(),
        cuisine: cuisine?.trim(),
        price: price?.trim(),
        area: area?.trim(),
        outdoor: outdoor?.trim().toUpperCase() === "TRUE",
        rating: parseInt(rating) || 1
      };
    });

  filteredRestaurants = [...restaurants];
  populateFilters();
  drawWheel();
}

// ================= FILTERS =================
function populateFilters() {
  const cuisines = [...new Set(restaurants.map(r => r.cuisine))];
  const areas = [...new Set(restaurants.map(r => r.area))];

  cuisines.forEach(c => {
    const option = document.createElement("option");
    option.value = c;
    option.textContent = c;
    document.getElementById("cuisine").appendChild(option);
  });

  areas.forEach(a => {
    const option = document.createElement("option");
    option.value = a;
    option.textContent = a;
    document.getElementById("area").appendChild(option);
  });
}

function applyFilters() {
  const cuisine = document.getElementById("cuisine").value;
  const price = document.getElementById("price").value;
  const area = document.getElementById("area").value;
  const outdoor = document.getElementById("outdoor").checked;

  filteredRestaurants = restaurants.filter(r =>
    (!cuisine || r.cuisine === cuisine) &&
    (!price || r.price === price) &&
    (!area || r.area === area) &&
    (!outdoor || r.outdoor)
  );

  currentRotation = 0;
  document.getElementById("result").textContent = "";
  drawWheel();
}

// ================= DRAW WHEEL =================
function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const count = filteredRestaurants.length;
  if (count === 0) {
    ctx.font = "20px Arial";
    ctx.fillText("No Results", 150, 200);
    return;
  }

  const angle = (2 * Math.PI) / count;

  filteredRestaurants.forEach((r, i) => {
    ctx.beginPath();
    ctx.moveTo(200, 200);
    ctx.arc(200, 200, 200, i * angle, (i + 1) * angle);
    ctx.fillStyle = `hsl(${i * 360 / count}, 70%, 60%)`;
    ctx.fill();

    ctx.save();
    ctx.translate(200, 200);
    ctx.rotate(i * angle + angle / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = "black";
    ctx.font = "14px Arial";
    ctx.fillText(`${r.name} (${r.rating}â­)`, 180, 5);
    ctx.restore();
  });
}

// ================= WEIGHTED RANDOM =================
function weightedRandomChoice(list) {
  const totalWeight = list.reduce((sum, r) => sum + r.rating, 0);
  let random = Math.random() * totalWeight;

  for (let r of list) {
    random -= r.rating;
    if (random <= 0) return r;
  }
}

// ================= SPIN =================
function spinWheel() {
  if (filteredRestaurants.length === 0) return;

  const winner = weightedRandomChoice(filteredRestaurants);
  const index = filteredRestaurants.indexOf(winner);

  const sliceAngle = 360 / filteredRestaurants.length;

  // Calculate exact angle so winner lands at top (arrow)
  const targetRotation =
    360 * 5 + (360 - index * sliceAngle - sliceAngle / 2);

  const spinDuration = 3000;
  const start = performance.now();
  const initialRotation = currentRotation;

  function animate(now) {
    const progress = Math.min((now - start) / spinDuration, 1);
    const ease = 1 - Math.pow(1 - progress, 3);

    currentRotation = initialRotation +
      (targetRotation - initialRotation) * ease;

    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.translate(200, 200);
    ctx.rotate(currentRotation * Math.PI / 180);
    ctx.translate(-200, -200);

    drawWheel();

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      document.getElementById("result").textContent =
        `ğŸ‰ We're eating: ${winner.name} (${winner.rating}â­)!`;
    }
  }

  requestAnimationFrame(animate);
}

fetchSheet();

</script>
</body>
</html>







